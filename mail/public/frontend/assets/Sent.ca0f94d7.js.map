{"version":3,"file":"Sent.ca0f94d7.js","sources":["../../../../frontend/src/pages/Sent.vue"],"sourcesContent":["<template>\n    <div>\n        <header class=\"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5\">\n            <Breadcrumbs :items=\"breadcrumbs\">\n                <template #suffix>\n                    <div v-if=\"outgoingMailCount.data\" class=\"self-end text-xs text-gray-600 ml-2\">\n                        {{ __('{0} {1}').format(formatNumber(outgoingMailCount.data), outgoingMailCount.data == 1 ? singularize('messages') : 'messages') }}\n                    </div>\n                </template>\n            </Breadcrumbs>\n            <HeaderActions />\n        </header>\n        <div v-if=\"outgoingMails.data\" class=\"flex\">\n            <div @scroll=\"loadMoreEmails\" ref=\"mailSidebar\"\n                class=\"mailSidebar border-r w-1/3 p-3 h-[calc(100vh-3.2rem)] sticky top-16 overflow-y-scroll overscroll-contain\">\n                <div v-for=\"(mail, idx) in outgoingMails.data\" @click=\"openMail(mail)\"\n                    class=\"flex flex-col p-2 space-y-1 cursor-pointer rounded\"\n                    :class=\"{ 'border-b': idx < outgoingMails.data.length - 1, 'bg-gray-200': mail.name == currentMail }\">\n                    <SidebarDetail :mail=\"mail\" />\n                </div>\n            </div>\n            <div class=\"flex w-px cursor-col-resize justify-center\" @mousedown=\"startResizing\">\n                <div ref=\"resizer\"\n                    class=\"h-full w-[2px] rounded-full transition-all duration-300 ease-in-out group-hover:bg-gray-400\" />\n            </div>\n            <div class=\"flex-1 overflow-auto w-2/3\">\n                <MailDetails :mailID=\"currentMail\" type=\"Outgoing Mail\"/>\n            </div>\n        </div>\n    </div>\n</template>\n<script setup>\nimport { Breadcrumbs, createResource, createListResource } from 'frappe-ui';\nimport { computed, inject, ref, onMounted } from 'vue';\nimport HeaderActions from \"@/components/HeaderActions.vue\";\nimport { formatNumber, startResizing, singularize } from \"@/utils\";\nimport MailDetails from \"@/components/MailDetails.vue\";\nimport { useDebounceFn } from '@vueuse/core'\nimport SidebarDetail from \"@/components/SidebarDetail.vue\";\n\nconst socket = inject('$socket')\nconst user = inject(\"$user\");\nconst mailStart = ref(0)\nconst mailList = ref([])\nconst currentMail = ref(JSON.parse(sessionStorage.getItem(\"currentOutgoingMail\")))\n\nonMounted(() => {\n    socket.on('outgoing_mail_sent', (data) => {\n\t\toutgoingMails.reload()\n        outgoingMailCount.reload()\n\t})\n})\n\nconst outgoingMails = createListResource({\n    url: \"mail.api.mail.get_outgoing_mails\",\n    doctype: \"Outgoing Mail\",\n    auto: true,\n    start: mailStart.value,\n    pageLength: 50,\n    cache: [\"outgoing\", user.data?.name],\n    onSuccess(data) {\n        mailList.value = mailList.value.concat(data)\n        mailStart.value = mailStart.value + data.length\n        if (!currentMail.value && mailList.value.length) {\n            setCurrentMail(mailList.value[0].name)\n        }\n    }\n});\n\nconst outgoingMailCount = createResource({\n    url: \"frappe.client.get_count\",\n    makeParams(values) {\n        return {\n            doctype: \"Outgoing Mail\",\n            filters: {\n                sender: user.data?.name,\n                status: \"Sent\"\n            }\n        }\n    },\n    cache: [\"outgoingMailCount\", user.data?.name],\n    auto: true,\n})\n\nconst loadMoreEmails = useDebounceFn(() => {\n    if (outgoingMails.hasNextPage)\n        outgoingMails.next()\n}, 500)\n\nconst setCurrentMail = (mail) => {\n    sessionStorage.setItem(\"currentOutgoingMail\", JSON.stringify(mail))\n}\n\nconst openMail = (mail) => {\n    currentMail.value = mail.name;\n    setCurrentMail(mail.name)\n}\n\nconst breadcrumbs = computed(() => {\n    return [\n        {\n            label: \"Sent\",\n            route: { name: \"Sent\" }\n        }\n    ];\n});\n</script>"],"names":["socket","inject","user","mailStart","ref","mailList","currentMail","onMounted","data","outgoingMails","outgoingMailCount","createListResource","_a","setCurrentMail","createResource","values","_b","loadMoreEmails","useDebounceFn","mail","openMail","breadcrumbs","computed"],"mappings":"uqBAwCA,MAAMA,EAASC,EAAO,SAAS,EACzBC,EAAOD,EAAO,OAAO,EACrBE,EAAYC,EAAI,CAAC,EACjBC,EAAWD,EAAI,EAAE,EACjBE,EAAcF,EAAI,KAAK,MAAM,eAAe,QAAQ,qBAAqB,CAAC,CAAC,EAEjFG,EAAU,IAAM,CACZP,EAAO,GAAG,qBAAuBQ,GAAS,CAC5CC,EAAc,OAAQ,EAChBC,EAAkB,OAAQ,CAClC,CAAE,CACF,CAAC,EAED,MAAMD,EAAgBE,EAAmB,CACrC,IAAK,mCACL,QAAS,gBACT,KAAM,GACN,MAAOR,EAAU,MACjB,WAAY,GACZ,MAAO,CAAC,YAAYS,EAAAV,EAAK,OAAL,YAAAU,EAAW,IAAI,EACnC,UAAUJ,EAAM,CACZH,EAAS,MAAQA,EAAS,MAAM,OAAOG,CAAI,EAC3CL,EAAU,MAAQA,EAAU,MAAQK,EAAK,OACrC,CAACF,EAAY,OAASD,EAAS,MAAM,QACrCQ,EAAeR,EAAS,MAAM,GAAG,IAAI,CAE5C,CACL,CAAC,EAEKK,EAAoBI,EAAe,CACrC,IAAK,0BACL,WAAWC,EAAQ,OACf,MAAO,CACH,QAAS,gBACT,QAAS,CACL,QAAQH,EAAAV,EAAK,OAAL,YAAAU,EAAW,KACnB,OAAQ,MACX,CACJ,CACJ,EACD,MAAO,CAAC,qBAAqBI,EAAAd,EAAK,OAAL,YAAAc,EAAW,IAAI,EAC5C,KAAM,EACV,CAAC,EAEKC,EAAiBC,EAAc,IAAM,CACnCT,EAAc,aACdA,EAAc,KAAM,CAC5B,EAAG,GAAG,EAEAI,EAAkBM,GAAS,CAC7B,eAAe,QAAQ,sBAAuB,KAAK,UAAUA,CAAI,CAAC,CACtE,EAEMC,EAAYD,GAAS,CACvBb,EAAY,MAAQa,EAAK,KACzBN,EAAeM,EAAK,IAAI,CAC5B,EAEME,EAAcC,EAAS,IAClB,CACH,CACI,MAAO,OACP,MAAO,CAAE,KAAM,MAAQ,CAC1B,CACT,CACC"}