{"version":3,"file":"Inbox.0b46cd7d.js","sources":["../../../../frontend/src/pages/Inbox.vue"],"sourcesContent":["<template>\n    <div class=\"\">\n        <header class=\"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5\">\n            <Breadcrumbs :items=\"breadcrumbs\">\n                <template #suffix>\n                    <div v-if=\"incomingMailCount.data\" class=\"self-end text-xs text-gray-600 ml-2\">\n                        {{ __('{0} {1}').format(formatNumber(incomingMailCount.data), incomingMailCount.data == 1 ? singularize('messages') : 'messages') }}\n                    </div>\n                </template>\n            </Breadcrumbs>\n            <HeaderActions />\n        </header>\n        <div v-if=\"incomingMails.data\" class=\"flex\">\n            <div @scroll=\"loadMoreEmails\" ref=\"mailSidebar\"\n                class=\"mailSidebar border-r w-1/3 p-3 h-[calc(100vh-3.2rem)] sticky top-16 overflow-y-scroll overscroll-contain\">\n                <div v-for=\"(mail, idx) in incomingMails.data\" @click=\"openMail(mail)\"\n                    class=\"flex flex-col p-2 space-y-1 cursor-pointer\"\n                    :class=\"{ 'border-b': idx < incomingMails.data.length - 1, 'bg-gray-200 rounded': mail.name == currentMail }\">\n                    <SidebarDetail :mail=\"mail\" />\n                </div>\n            </div>\n            <div class=\"flex w-px cursor-col-resize justify-center\" @mousedown=\"startResizing\">\n                <div ref=\"resizer\"\n                    class=\"h-full w-[2px] rounded-full transition-all duration-300 ease-in-out group-hover:bg-gray-400\" />\n            </div>\n            <div class=\"flex-1 overflow-auto w-2/3\">\n                <MailDetails :mailID=\"currentMail\" type=\"Incoming Mail\"/>\n            </div>\n        </div>\n    </div>\n</template>\n<script setup>\nimport { Breadcrumbs, createListResource, createResource } from \"frappe-ui\";\nimport { computed, inject, ref, onMounted } from \"vue\";\nimport { formatNumber, startResizing, singularize } from \"@/utils\";\nimport HeaderActions from \"@/components/HeaderActions.vue\";\nimport MailDetails from \"@/components/MailDetails.vue\";\nimport { useDebounceFn } from '@vueuse/core'\nimport SidebarDetail from \"@/components/SidebarDetail.vue\";\n\nconst socket = inject('$socket')\nconst user = inject(\"$user\");\nconst mailStart = ref(0)\nconst mailList = ref([])\nconst currentMail = ref(JSON.parse(sessionStorage.getItem(\"currentIncomingMail\")))\n\nonMounted(() => {\n    socket.on('incoming_mail_received', (data) => {\n        incomingMails.reload()\n        incomingMailCount.reload()\n    })\n})\n\nconst setCurrentMail = (mail) => {\n    sessionStorage.setItem(\"currentIncomingMail\", JSON.stringify(mail))\n}\n\nconst incomingMails = createListResource({\n   url: \"mail.api.mail.get_incoming_mails\",\n   doctype: \"Incoming Mail\",\n   auto: true,\n   start: mailStart.value,\n   pageLength: 50,\n   cache: [\"incoming\", user.data?.name],\n   onSuccess(data) {\n        mailList.value = mailList.value.concat(data)\n        mailStart.value = mailStart.value + data.length\n       if (!currentMail.value && mailList.value.length) {\n            currentMail.value = mailList.value[0].name\n           setCurrentMail(mailList.value[0].name)\n       }\n   }\n});\n\nconst incomingMailCount = createResource({\n    url: \"frappe.client.get_count\",\n    makeParams(values) {\n        return {\n            doctype: \"Incoming Mail\",\n            filters: {\n                receiver: user.data?.name,\n            }\n        }\n    },\n    cache: [\"incomingMailCount\", user.data?.name],\n    auto: true,\n})\n\nconst loadMoreEmails = useDebounceFn(() => {\n    if (incomingMails.hasNextPage)\n        incomingMails.next()\n}, 500)\n\nconst openMail = (mail=null) => {\n    currentMail.value = mail.name\n    setCurrentMail(mail.name)\n}\n\nconst breadcrumbs = computed(() => {\n    return [{\n        label: `Inbox`,\n        route: { name: \"Inbox\" }\n    }]\n})\n\n\n\n</script>"],"names":["socket","inject","user","mailStart","ref","mailList","currentMail","onMounted","data","incomingMails","incomingMailCount","setCurrentMail","mail","createListResource","_a","createResource","values","_b","loadMoreEmails","useDebounceFn","openMail","breadcrumbs","computed"],"mappings":"irBAwCA,MAAMA,EAASC,EAAO,SAAS,EACzBC,EAAOD,EAAO,OAAO,EACrBE,EAAYC,EAAI,CAAC,EACjBC,EAAWD,EAAI,EAAE,EACjBE,EAAcF,EAAI,KAAK,MAAM,eAAe,QAAQ,qBAAqB,CAAC,CAAC,EAEjFG,EAAU,IAAM,CACZP,EAAO,GAAG,yBAA2BQ,GAAS,CAC1CC,EAAc,OAAQ,EACtBC,EAAkB,OAAQ,CAClC,CAAK,CACL,CAAC,EAED,MAAMC,EAAkBC,GAAS,CAC7B,eAAe,QAAQ,sBAAuB,KAAK,UAAUA,CAAI,CAAC,CACtE,EAEMH,EAAgBI,EAAmB,CACtC,IAAK,mCACL,QAAS,gBACT,KAAM,GACN,MAAOV,EAAU,MACjB,WAAY,GACZ,MAAO,CAAC,YAAYW,EAAAZ,EAAK,OAAL,YAAAY,EAAW,IAAI,EACnC,UAAUN,EAAM,CACXH,EAAS,MAAQA,EAAS,MAAM,OAAOG,CAAI,EAC3CL,EAAU,MAAQA,EAAU,MAAQK,EAAK,OACtC,CAACF,EAAY,OAASD,EAAS,MAAM,SACpCC,EAAY,MAAQD,EAAS,MAAM,GAAG,KACvCM,EAAeN,EAAS,MAAM,GAAG,IAAI,EAE5C,CACJ,CAAC,EAEKK,EAAoBK,EAAe,CACrC,IAAK,0BACL,WAAWC,EAAQ,OACf,MAAO,CACH,QAAS,gBACT,QAAS,CACL,UAAUF,EAAAZ,EAAK,OAAL,YAAAY,EAAW,IACxB,CACJ,CACJ,EACD,MAAO,CAAC,qBAAqBG,EAAAf,EAAK,OAAL,YAAAe,EAAW,IAAI,EAC5C,KAAM,EACV,CAAC,EAEKC,EAAiBC,EAAc,IAAM,CACnCV,EAAc,aACdA,EAAc,KAAM,CAC5B,EAAG,GAAG,EAEAW,EAAW,CAACR,EAAK,OAAS,CAC5BN,EAAY,MAAQM,EAAK,KACzBD,EAAeC,EAAK,IAAI,CAC5B,EAEMS,EAAcC,EAAS,IAClB,CAAC,CACJ,MAAO,QACP,MAAO,CAAE,KAAM,OAAS,CAChC,CAAK,CACJ"}