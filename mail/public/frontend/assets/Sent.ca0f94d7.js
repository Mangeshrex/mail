import{a as y,r as f,s as C,a3 as N,k as O,a4 as $,j as z,x as n,y as r,G as l,L as m,F as I,I as e,J as L,K as b,a5 as j,R as D,S as R,H as B}from"./frappe-ui.610d13b5.js";import{_ as F,a as J,b as V}from"./SidebarDetail.e508b68a.js";import{f as E,s as P,a as h}from"./index.e8c12950.js";const G={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},H={key:0,class:"self-end text-xs text-gray-600 ml-2"},K={key:0,class:"flex"},q=["onClick"],A={ref:"resizer",class:"h-full w-[2px] rounded-full transition-all duration-300 ease-in-out group-hover:bg-gray-400"},Q={class:"flex-1 overflow-auto w-2/3"},Z={__name:"Sent",setup(T){var v,x;const S=y("$socket"),d=y("$user"),g=f(0),i=f([]),u=f(JSON.parse(sessionStorage.getItem("currentOutgoingMail")));C(()=>{S.on("outgoing_mail_sent",a=>{o.reload(),c.reload()})});const o=N({url:"mail.api.mail.get_outgoing_mails",doctype:"Outgoing Mail",auto:!0,start:g.value,pageLength:50,cache:["outgoing",(v=d.data)==null?void 0:v.name],onSuccess(a){i.value=i.value.concat(a),g.value=g.value+a.length,!u.value&&i.value.length&&p(i.value[0].name)}}),c=O({url:"frappe.client.get_count",makeParams(a){var t;return{doctype:"Outgoing Mail",filters:{sender:(t=d.data)==null?void 0:t.name,status:"Sent"}}},cache:["outgoingMailCount",(x=d.data)==null?void 0:x.name],auto:!0}),_=$(()=>{o.hasNextPage&&o.next()},500),p=a=>{sessionStorage.setItem("currentOutgoingMail",JSON.stringify(a))},M=a=>{u.value=a.name,p(a.name)},k=z(()=>[{label:"Sent",route:{name:"Sent"}}]);return(a,t)=>(n(),r("div",null,[l("header",G,[m(e(j),{items:k.value},{suffix:I(()=>[e(c).data?(n(),r("div",H,L(a.__("{0} {1}").format(e(E)(e(c).data),e(c).data==1?e(P)("messages"):"messages")),1)):b("",!0)]),_:1},8,["items"]),m(F)]),e(o).data?(n(),r("div",K,[l("div",{onScroll:t[0]||(t[0]=(...s)=>e(_)&&e(_)(...s)),ref:"mailSidebar",class:"mailSidebar border-r w-1/3 p-3 h-[calc(100vh-3.2rem)] sticky top-16 overflow-y-scroll overscroll-contain"},[(n(!0),r(D,null,R(e(o).data,(s,w)=>(n(),r("div",{onClick:U=>M(s),class:B(["flex flex-col p-2 space-y-1 cursor-pointer rounded",{"border-b":w<e(o).data.length-1,"bg-gray-200":s.name==u.value}])},[m(V,{mail:s},null,8,["mail"])],10,q))),256))],544),l("div",{class:"flex w-px cursor-col-resize justify-center",onMousedown:t[1]||(t[1]=(...s)=>e(h)&&e(h)(...s))},[l("div",A,null,512)],32),l("div",Q,[m(J,{mailID:u.value,type:"Outgoing Mail"},null,8,["mailID"])])])):b("",!0)]))}};export{Z as default};
//# sourceMappingURL=Sent.ca0f94d7.js.map
