import{a as b,r as g,s as w,a3 as C,k as N,a4 as $,j as z,x as i,y as l,G as c,L as m,F as L,I as e,J as j,K as h,a5 as D,R,S as B,H as F}from"./frappe-ui.610d13b5.js";import{f as J,s as V,a as y}from"./index.e8c12950.js";import{_ as E,a as O,b as P}from"./SidebarDetail.e508b68a.js";const G={class:""},H={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},K={key:0,class:"self-end text-xs text-gray-600 ml-2"},q={key:0,class:"flex"},A=["onClick"],Q={ref:"resizer",class:"h-full w-[2px] rounded-full transition-all duration-300 ease-in-out group-hover:bg-gray-400"},T={class:"flex-1 overflow-auto w-2/3"},ee={__name:"Inbox",setup(U){var v,x;const M=b("$socket"),d=b("$user"),f=g(0),o=g([]),r=g(JSON.parse(sessionStorage.getItem("currentIncomingMail")));w(()=>{M.on("incoming_mail_received",a=>{n.reload(),u.reload()})});const _=a=>{sessionStorage.setItem("currentIncomingMail",JSON.stringify(a))},n=C({url:"mail.api.mail.get_incoming_mails",doctype:"Incoming Mail",auto:!0,start:f.value,pageLength:50,cache:["incoming",(v=d.data)==null?void 0:v.name],onSuccess(a){o.value=o.value.concat(a),f.value=f.value+a.length,!r.value&&o.value.length&&(r.value=o.value[0].name,_(o.value[0].name))}}),u=N({url:"frappe.client.get_count",makeParams(a){var s;return{doctype:"Incoming Mail",filters:{receiver:(s=d.data)==null?void 0:s.name}}},cache:["incomingMailCount",(x=d.data)==null?void 0:x.name],auto:!0}),p=$(()=>{n.hasNextPage&&n.next()},500),I=(a=null)=>{r.value=a.name,_(a.name)},k=z(()=>[{label:"Inbox",route:{name:"Inbox"}}]);return(a,s)=>(i(),l("div",G,[c("header",H,[m(e(D),{items:k.value},{suffix:L(()=>[e(u).data?(i(),l("div",K,j(a.__("{0} {1}").format(e(J)(e(u).data),e(u).data==1?e(V)("messages"):"messages")),1)):h("",!0)]),_:1},8,["items"]),m(E)]),e(n).data?(i(),l("div",q,[c("div",{onScroll:s[0]||(s[0]=(...t)=>e(p)&&e(p)(...t)),ref:"mailSidebar",class:"mailSidebar border-r w-1/3 p-3 h-[calc(100vh-3.2rem)] sticky top-16 overflow-y-scroll overscroll-contain"},[(i(!0),l(R,null,B(e(n).data,(t,S)=>(i(),l("div",{onClick:W=>I(t),class:F(["flex flex-col p-2 space-y-1 cursor-pointer",{"border-b":S<e(n).data.length-1,"bg-gray-200 rounded":t.name==r.value}])},[m(P,{mail:t},null,8,["mail"])],10,A))),256))],544),c("div",{class:"flex w-px cursor-col-resize justify-center",onMousedown:s[1]||(s[1]=(...t)=>e(y)&&e(y)(...t))},[c("div",Q,null,512)],32),c("div",T,[m(O,{mailID:r.value,type:"Incoming Mail"},null,8,["mailID"])])])):h("",!0)]))}};export{ee as default};
//# sourceMappingURL=Inbox.0b46cd7d.js.map
